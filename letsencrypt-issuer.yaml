  apiVersion: cert-manager.io/v1
  kind: ClusterIssuer
  metadata:
    name: letsencrypt-prod
  spec:
    acme:
      server: https://acme-v02.api.letsencrypt.org/directory
      email: devops@steghub.com
      privateKeySecretRef:
        name: letsencrypt-prod
      solvers:
      - selector:
          dnsZones:
            - "steghub.com"
        dns01:
          route53:
            region: us-east-1
            role: "arn:aws:iam::312973238800:role/cert_manager_role" # This must be set so cert-manager what role to attempt to authenticate with
            auth:
              kubernetes:
                serviceAccountRef:
                  name: "cert-manager" # The name of the service account created

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: cert-manager-tokenrequest
  namespace: cert-manager
rules:
  - apiGroups: ['']
    resources: ['serviceaccounts/token']
    resourceNames: ['cert-manager']
    verbs: ['create']
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: cert-manager-cert-manager-tokenrequest
  namespace: cert-manager
subjects:
  - kind: ServiceAccount
    name: cert-manager
    namespace: cert-manager
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cert-manager-tokenrequest